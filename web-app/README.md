# 現地チェックシートアプリ（Webプロトタイプ）

不動産物件の不具合検査を行うWebアプリケーションのプロトタイプです。
お客様とのすり合わせ後、Androidアプリとして実装予定です。

## 技術スタック

- **フロントエンド**: React 19 + TypeScript
- **ビルドツール**: Vite 7
- **ルーティング**: React Router v7
- **スタイリング**: TailwindCSS
- **データ保存**: LocalStorage（ブラウザローカル）
- **カメラ機能**: WebカメラAPI
- **図面機能**: Canvas API（マーカー配置、方位アイコン描画）
- **画像圧縮**: WebP形式、品質80%（自動圧縮で容量を約83%削減）
- **セキュリティ**: SHA-256パスワードハッシュ化
- **クラウドストレージ**: Backblaze B2（オプション）

## セットアップ

```bash
# 依存パッケージのインストール
npm install

# 開発サーバーの起動
npm run dev

# ビルド
npm run build

# プレビュー
npm run preview
```

## Vercelへのデプロイ（Basic認証付き）

このアプリケーションはVercelで静的サイトとしてデプロイできます。Basic認証が設定されています。

### 初回デプロイ手順

1. **Vercelプロジェクトの作成**
   ```bash
   # Vercel CLIをインストール（初回のみ）
   npm install -g vercel
   
   # プロジェクトディレクトリでVercelにログイン
   vercel login
   
   # デプロイ
   vercel
   ```

2. **環境変数の設定**
   
   Vercelダッシュボードで以下の環境変数を設定してください：
   
   - `BASIC_AUTH_USER`: Basic認証のユーザー名（例: `admin`）
   - `BASIC_AUTH_PASSWORD`: Basic認証のパスワード（強力なパスワードを設定）

   設定方法：
   1. Vercelダッシュボードでプロジェクトを選択
   2. Settings > Environment Variables
   3. 上記の変数を追加
   4. 再デプロイ

3. **本番デプロイ**
   ```bash
   vercel --prod
   ```

### デプロイ後のアクセス

- デプロイされたURLにアクセスすると、Basic認証のダイアログが表示されます
- 設定した`BASIC_AUTH_USER`と`BASIC_AUTH_PASSWORD`でログイン
- ログイン後、アプリの通常のログイン画面が表示されます

### セキュリティ注意事項

- **Basic認証のパスワードは必ず強力なものを設定してください**
- 環境変数は本番環境とプレビュー環境で別々に設定できます
- `.env.example`ファイルを参考に、ローカル開発用の`.env`ファイルを作成できます（Gitにはコミットしないでください）

## ログイン情報

### Basic認証（Vercelデプロイ時）
サイトにアクセスする際のBasic認証：
- **ユーザー名**: `kennet`
- **パスワード**: `kennet2025`

### アプリケーションログイン
Basic認証通過後、以下の固定アカウントでアプリにログインできます：
- **ユーザー1**: `user1` / `KennetInspect2025!User1`
- **ユーザー2**: `user2` / `KennetInspect2025!User2`

**セキュリティ:**
- パスワードはSHA-256でハッシュ化されて保存されています
- パスワードには大文字・小文字・数字・記号が含まれており、セキュリティが強化されています

## 主な機能

### 1. ログイン機能
- 固定2アカウントによる認証

### 2. 物件管理
- 物件の登録・一覧表示・削除
- 物件情報（名前、住所、検査日、天候）の管理
- **定形写真管理**（16種類の必須・任意写真）
- データエクスポート機能

### 3. 階層管理
- 各物件に対する階層（1F、2F、屋上など）の登録・管理

### 4. 図面管理
- 各階層に対する図面画像の取り込み
- **方位設定機能**
  - 回転モード: 方位アイコンの角度調整（5度刻み、0-355度）
  - 移動モード: アイコンの位置調整（図面上の任意の場所）
  - サイズ調整: アイコンの拡大・縮小（0.5倍-3.0倍）
  - プリセットボタン: 北/東/南/西の素早い設定
- 図面の表示・削除

### 5. 検査機能
- 図面上をタップして撮影箇所を指定
- 検査情報の入力（大分類、中分類、小分類、検査結果）
- 検査結果に応じた分岐処理：
  - **a/b1**: 撮影不要（マーカーのみ保存）
  - **b2/c**: 撮影が必要

### 6. 不具合記録
- カメラによる撮影
- 不具合情報の記入（場所、部位、劣化状況、補修方法）
- 撮影した画像の保存
- **不具合一覧の表示**
- **不具合の編集・削除**
- **画像の再撮影**

### 7. 参考画像
- 不具合以外の参考画像の撮影
- メモの追加・編集
- 参考画像一覧の表示・削除

### 8. データ管理
- すべてのデータはLocalStorageに保存
- 物件単位でのデータエクスポート（JSON形式）
- **Backblaze B2へのアップロード機能**（環境変数設定時のみ）
  - 物件詳細画面から全画像を一括アップロード
  - 進捗表示機能付き

## 画面遷移フロー

```
ログイン
  ↓
物件一覧
  ↓
物件登録
  ↓
日付・天候入力
  ↓
定形写真撮影（16枚）
  ↓
物件詳細
  ↓
階層追加
  ↓
図面管理
  ↓
図面登録
  ↓
方位設定（回転・移動・サイズ調整）
  ↓
図面表示（メイン画面）
  ↓
検査情報入力
  ↓ (b2/c選択時)
撮影
  ↓
不具合記入
  ↓
図面表示（戻る）
```

## 使用方法

### 基本的な流れ

1. **ログイン**
   - テストアカウントでログイン

2. **物件の登録**
   - 物件一覧から「新規物件追加」をクリック
   - 物件名と住所を入力

3. **日付と天候の入力**
   - 検査日をカレンダーから選択
   - 天候をセレクトボックスから選択

4. **定形写真の撮影**
   - 16種類の必須・任意写真を撮影
   - 必須14枚をすべて撮影すると「次へ」ボタンが有効化

5. **階層の追加**
   - 物件詳細画面で「階層追加」をクリック
   - 階層名（例: 1F、2F）を入力

6. **図面の取り込みと方位設定**
   - 階層を選択して図面管理画面へ
   - 「図面を追加」から画像ファイルを選択
   - 方位設定画面で以下を設定：
     - **回転モード**: タップ&ドラッグまたはプリセットボタンで方位を設定
     - **移動モード**: アイコンを見やすい位置にドラッグ
     - **サイズ調整**: 拡大・縮小ボタンでアイコンサイズを調整
   - 「確定」をクリックして保存

7. **検査の実施**
   - 図面表示画面で図面上をタップ
   - 検査情報（大分類、中分類、小分類、検査結果）を入力
   - b2/cの場合は撮影と不具合記入を実施

8. **通常撮影**
   - 図面表示画面の右上「通常撮影」ボタンから撮影
   - メモを追加して保存

9. **不具合一覧の確認と管理**
   - 図面表示画面の右上「不具合一覧」ボタンから一覧を表示
   - 各不具合をタップして詳細を確認
   - 不具合情報の編集・削除
   - 画像の再撮影も可能

10. **データのエクスポート**
   - 物件詳細画面の「データエクスポート」ボタンでJSON形式でダウンロード
   - エクスポートされるデータ：
     - 物件情報（検査日、天候、定形写真含む）
     - 階層情報
     - 図面情報（**方位設定含む**: 方位角度、アイコン位置・サイズ）
     - マーカー情報
     - **検査チェックシート**（101項目の評価データ）
       - 各項目の評価結果（a/b1/b2/c/−、S/A/B/C、無/有など）
       - 場所メモ
       - 複数評価対応（同一項目に複数箇所の評価）
       - 配筋ピッチ、シュミットハンマー測定値
     - 不具合情報
     - 通常撮影

11. **Backblaze B2へのアップロード**（設定済みの場合）
   - 物件詳細画面の「B2にアップロード」ボタンをクリック
   - すべての画像（図面、不具合、参考画像）がクラウドに保存されます
   - 進捗状況がリアルタイムで表示されます

## 開発時の注意点

### カメラ機能について
- カメラ機能はHTTPSまたはlocalhostでのみ動作します
- モバイルデバイスでテストする場合は、HTTPSでホストする必要があります

### データの永続化
- LocalStorageを使用しているため、ブラウザのデータをクリアするとすべてのデータが消えます
- 重要なデータは定期的にエクスポートしてください

### 画像について
- 画像はWebP形式（品質80%）で自動圧縮されます
- 撮影時: 元の画像サイズの約17%に圧縮（3MB → 500KB程度）
- 図面アップロード時: 同様に自動圧縮されます
- 画像はBase64形式でLocalStorageに保存されます
- LocalStorageには容量制限（通常5-10MB）があるため、定期的なデータエクスポートを推奨します
- 開発モード時は画面右下にLocalStorage使用状況が表示されます（💾アイコン）

### Backblaze B2について
- `.env.local`ファイルで設定することで、クラウドストレージ機能が有効化されます
- 物件詳細画面から全画像を一括でB2にアップロード可能
- アップロード後もLocalStorageのデータは保持されます（二重バックアップ）
- 年間コスト: 約$2〜$3（1,000物件、圧縮済み画像）

## 今後の展開

このWebプロトタイプでお客様とのすり合わせを行い、以下を実装予定：

1. **Androidアプリ化**
   - React NativeまたはKotlinでのネイティブ実装
   - オフライン完全対応
   - USB経由でのデータ取り出し機能

2. **機能の追加・改善**
   - お客様からのフィードバックを反映
   - UI/UXの改善
   - データ形式の最適化

## ライセンス

非公開プロジェクト

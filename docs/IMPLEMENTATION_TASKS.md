# 実装タスク一覧と役割分担

## 概要

Backblaze B2を使った画像ストレージ戦略の実装に向けた、段階的なタスク一覧です。
各タスクを**Claude Code（AI）が対応**するものと、**あなた（人間）が対応**するものに分類しています。

---

## フェーズ1: Webプロトタイプの画像圧縮機能実装

### 🤖 Claude Codeが対応

- [ ] **画像圧縮ユーティリティの実装**
  - `src/utils/imageCompression.ts` を作成
  - Base64画像をWebP形式に圧縮する関数
  - リサイズ機能の実装
  - サムネイル生成機能の実装
  
- [ ] **カメラページの改修**
  - `src/pages/CameraPage.tsx` の修正
  - 撮影後に自動圧縮処理を追加
  - 圧縮前後のサイズ表示機能（デバッグ用）
  
- [ ] **型定義の更新**
  - `src/types/index.ts` に画像メタデータ型を追加
  - 圧縮設定の型定義
  
- [ ] **LocalStorageの容量チェック機能**
  - `src/storage/localStorage.ts` に容量監視機能を追加
  - 警告表示の実装
  
- [ ] **画像圧縮設定UIの追加**
  - 設定ページ（オプション）
  - 圧縮品質の調整UI

### 👤 あなたが対応

- [ ] **ブラウザでの動作確認**
  - 実際のカメラで撮影テスト
  - 圧縮後の画質確認
  - LocalStorageの容量確認
  
- [ ] **圧縮品質の決定**
  - 画質と容量のバランスを確認
  - 最適な圧縮率を決定（推奨: WebP 80%）

---

## フェーズ2: Backblaze B2の準備

### 🤖 Claude Codeが対応

- [ ] **環境変数の設定ファイル作成**
  - `web-app/.env.example` を作成
  - 必要な環境変数のドキュメント化
  
- [ ] **Backblaze B2クライアントの実装**
  - `src/services/b2Storage.ts` を作成
  - S3互換APIを使用したアップロード機能
  - ダウンロード機能
  - エラーハンドリング
  
- [ ] **型定義の追加**
  - B2アップロード用の型定義
  - レスポンス型の定義
  
- [ ] **アップロード状態管理の実装**
  - アップロード中の状態表示
  - プログレスバー
  - リトライ機能

### 👤 あなたが対応

- [ ] **Backblaze B2アカウントの作成**
  - https://www.backblaze.com/b2/sign-up.html からアカウント作成
  - 無料枠: 10GB、クレジットカード登録不要
  
- [ ] **バケットの作成**
  - Backblaze B2ダッシュボードにログイン
  - 新しいバケットを作成（例: `kennet-inspection-images`）
  - バケットタイプ: **Private** （重要！）
  - Region: 日本に近いリージョン（推奨: US West）
  
- [ ] **Application Keyの発行**
  - Backblaze B2ダッシュボード → App Keys
  - "Add a New Application Key" をクリック
  - 権限: Read and Write
  - バケット制限: 作成したバケットのみ
  - **KeyID** と **Application Key** をコピー（二度と表示されません！）
  
- [ ] **環境変数の設定**
  - `web-app/.env.local` を作成（Gitには含めない）
  ```
  VITE_B2_KEY_ID=your_key_id_here
  VITE_B2_APPLICATION_KEY=your_application_key_here
  VITE_B2_BUCKET_NAME=kennet-inspection-images
  VITE_B2_REGION=us-west-004
  ```
  
- [ ] **コスト監視アラートの設定**
  - Backblaze B2ダッシュボード → Billing
  - 予算アラート設定（例: 月間$5超過時に通知）

---

## フェーズ3: Webプロトタイプでのバックアップ機能実装

### 🤖 Claude Codeが対応

- [ ] **アップロード機能の実装**
  - 物件完了時にB2へアップロードするボタン追加
  - 全画像の一括アップロード機能
  - アップロード履歴の管理
  
- [ ] **ダウンロード機能の実装**
  - B2から画像を取得して表示
  - ローカルキャッシュ機能
  
- [ ] **データエクスポート機能の改修**
  - 既存のJSON形式に加えて、B2のURLを含める
  - 画像はB2から取得する方式に変更
  
- [ ] **UIの改修**
  - アップロード状態の表示
  - エラー表示
  - ネットワーク状態の確認

### 👤 あなたが対応

- [ ] **実際のデータでテスト**
  - 実際の物件データでアップロードテスト
  - Backblaze B2ダッシュボードでファイル確認
  - ダウンロード速度の確認
  
- [ ] **コスト実測**
  - 実際の使用量を確認
  - 1物件あたりのコスト計算
  - 月次レポートの確認

---

## フェーズ4: セキュリティ強化（オプション）

### 🤖 Claude Codeが対応

- [ ] **中間サーバーの実装（推奨）**
  - `web-app/api/b2-upload.ts` を作成（Vercel Serverless Function）
  - 署名付きURLの発行機能
  - 認証チェック機能
  
- [ ] **クライアント側の修正**
  - 直接アップロードから署名付きURL方式に変更
  - APIキーをクライアントから削除

### 👤 あなたが対応

- [ ] **Vercelへの環境変数設定**
  - Vercelダッシュボードで環境変数を設定
  - `B2_KEY_ID`, `B2_APPLICATION_KEY` 等
  
- [ ] **セキュリティ監査**
  - APIキーが公開されていないか確認
  - バケットのアクセス権限確認

---

## フェーズ5: Androidアプリ開発（将来）

### 🤖 Claude Codeが対応

- [ ] **Androidプロジェクトの初期設定**
  - Kotlin + Jetpack Compose プロジェクト作成
  - 依存関係の設定
  
- [ ] **ローカルデータベース実装**
  - Room Database のセットアップ
  - エンティティ定義
  - DAO実装
  
- [ ] **画像圧縮機能（Android版）**
  - Kotlin でのWebP圧縮実装
  - サムネイル生成
  
- [ ] **Backblaze B2 SDK統合**
  - AWS S3 SDK for Android の設定
  - アップロード/ダウンロード機能実装
  
- [ ] **オフライン同期機能**
  - WorkManager での自動同期
  - Wi-Fi接続検知
  - バックグラウンドアップロード
  
- [ ] **UIの実装**
  - Jetpack Compose での画面実装
  - カメラ機能
  - 図面表示機能

### 👤 あなたが対応

- [ ] **Android Studio のセットアップ**
  - Android Studio のインストール
  - エミュレータまたは実機の準備
  
- [ ] **実機テスト**
  - カメラ機能のテスト
  - オフライン動作確認
  - 同期機能テスト
  
- [ ] **お客様へのデモ**
  - プロトタイプのデモンストレーション
  - フィードバック収集
  - 機能要件の最終確認

---

## 優先順位と推奨スケジュール

### 🚀 今すぐ開始（Week 1-2）

**フェーズ1: 画像圧縮機能** を最優先で実装
- 🤖 Claude Code: 画像圧縮ユーティリティ実装
- 👤 あなた: ブラウザで動作確認、品質チェック

**期待される効果**:
- LocalStorageの容量問題を解決
- 画像サイズが1/6に削減
- B2移行後のコスト削減の基盤

---

### 📋 次のステップ（Week 3-4）

**フェーズ2: Backblaze B2準備**
- 👤 あなた: B2アカウント作成、バケット設定、APIキー発行
- 🤖 Claude Code: B2クライアント実装

**フェーズ3: バックアップ機能実装**
- 🤖 Claude Code: アップロード/ダウンロード機能
- 👤 あなた: 実データでテスト、コスト実測

**期待される効果**:
- Webプロトタイプで完全なバックアップ機能
- お客様へのデモ準備完了
- コスト実測データ取得

---

### 🔐 追加対応（Week 5-6、オプション）

**フェーズ4: セキュリティ強化**
- 🤖 Claude Code: 中間サーバー実装
- 👤 あなた: Vercel設定、セキュリティ監査

**実施判断基準**:
- お客様との契約が確定してから
- 本番運用が決定してから

---

### 📱 将来対応（契約確定後）

**フェーズ5: Androidアプリ開発**
- お客様とのすり合わせ完了後に開始
- Webプロトタイプでの学びを反映

---

## 現時点での推奨アクション

### 今日から始めること

1. **👤 あなた**: Backblaze B2のアカウントを作成（無料、5分で完了）
   - https://www.backblaze.com/b2/sign-up.html
   
2. **🤖 Claude Code**: フェーズ1の画像圧縮機能を実装開始

### 今週中に完了させること

- ✅ フェーズ1完了（画像圧縮）
- ✅ フェーズ2準備（B2アカウント設定）
- ✅ フェーズ3開始（B2統合の実装開始）

---

## チェックリスト形式での進捗管理

各タスクの横にある `[ ]` に `[x]` を入れて進捗を管理できます。

### Phase 1: 画像圧縮 ⚡ 最優先

#### 🤖 Claude Code
- [ ] 画像圧縮ユーティリティ作成
- [ ] カメラページ改修
- [ ] 型定義更新
- [ ] LocalStorage容量チェック機能

#### 👤 あなた
- [ ] 動作確認
- [ ] 画質チェック
- [ ] 圧縮率決定

---

### Phase 2: B2準備

#### 🤖 Claude Code
- [ ] .env.example 作成
- [ ] B2クライアント実装
- [ ] 型定義追加
- [ ] アップロード状態管理

#### 👤 あなた
- [ ] B2アカウント作成
- [ ] バケット作成
- [ ] APIキー発行
- [ ] .env.local 設定
- [ ] コスト監視設定

---

### Phase 3: B2統合

#### 🤖 Claude Code
- [ ] アップロード機能実装
- [ ] ダウンロード機能実装
- [ ] エクスポート機能改修
- [ ] UI改修

#### 👤 あなた
- [ ] 実データテスト
- [ ] B2ダッシュボード確認
- [ ] コスト実測

---

## サポートが必要な場合

### 🤖 Claude Codeに依頼できること

- コードの実装
- バグ修正
- ドキュメント作成
- 設定ファイルの作成
- エラーのデバッグ

### 👤 あなたが判断すべきこと

- 画質と容量のバランス
- セキュリティ要件
- お客様へのデモ内容
- 本番運用の開始時期
- 予算とコスト管理

---

## 次のステップ

このドキュメントを確認したら、以下を決定してください：

1. **いつフェーズ1（画像圧縮）を開始するか？**
   - 推奨: 今すぐ開始
   
2. **Backblaze B2アカウントをいつ作成するか？**
   - 推奨: 今日〜明日中
   
3. **セキュリティ強化（フェーズ4）は必要か？**
   - 判断基準: お客様との契約状況

準備ができたら「フェーズ1を開始してください」とお伝えいただければ、すぐに実装を開始します！

---

**作成日**: 2025-12-17  
**最終更新**: 2025-12-17
